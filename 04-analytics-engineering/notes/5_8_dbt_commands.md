# dbt Course

## dbt Commands
[![](https://markdown-videos-api.jorgenkh.no/youtube/t4OeWHW3SsA)](https://www.youtube.com/t4OeWHW3SsA)

[00:00:01]  
### Overview of Key DVT Commands and Project Initialization  
- The **DVT init** command initializes a DVT project by creating the necessary directory structure, including folders such as **models, seeds, snapshots, tests, analysis**, etc.  
- This command only needs to be run once at the start of the project.  
- The video begins by revisiting previously introduced DVT commands and setting the stage for a comprehensive explanation of the most common commands and flags.

[00:00:33]  
### DVT Debug and Feature-Specific Commands  
- **DVT debug** verifies the connection to the database by checking the `profiles.jamo` configuration file; it confirms if the connection is valid.  
- Feature-specific commands include:  
  - **DVT seed** (singular): Ingests all CSV files located in the `seeds` folder into the database.  
  - **DVT snapshot**: Manages snapshots, although not actively used in this example.  
  - **DVT source freshness**: Checks if the source data is fresh or stale based on freshness specifications in the project.  
  - **DVT docs generate**: Generates a `catalog.json` artifact used to build documentation websites.  
  - **DVT docs surf**: Allows local browsing of documentation websites generated by DVT. *Note*: On **DVT Cloud**, hosting and browsing docs are automatic, so manual use of `docs surf` is unnecessary.  
- Generating docs (`docs generate`) is typically done before deployments and can be automated or run manually.

[00:02:36]  
### Cleaning and Dependency Management  
- **DVT clean** removes specified artifacts such as **targets** and **packages**. These are default clean targets but can be customized via the `project.jmo` file.  
- After cleaning packages, dependencies must be reinstalled using **DVT deps** (short for dependencies).  
- **DVT compile** processes all DVT models by rendering all Jinja templating and references into raw SQL files. These compiled SQL files are saved under the `target/compiled` directory.  
  - This compilation step helps **quickly identify errors in Jinja code** before running full builds.  
  - It is faster and free compared to running a full DVT build.

[00:04:31]  
### Core DVT Commands: Run, Test, Build, and Retry  
- **DVT run** executes all models in the project, materializing them as views, tables, incremental tables, or ephemeral models depending on configuration.  
- **DVT test** runs all tests defined in the project, including unit tests, generic tests, and singular tests. Example result: "Finished 37 data tests. All passed."  
- **DVT build** is a **composite command** that smartly combines running models, tests, seeds, snapshots, and user-defined functions (UDFs).  
  - It runs these tasks in the correct order and stops immediately if errors occur.  
  - Efficiently skips downstream dependencies if an upstream failure happens, saving compute resources.  
- **DVT retry** is used to resume a build or run from the point of failure, avoiding the need to rerun the entire pipeline. Particularly useful for large projects to optimize time and resource use.

[00:07:40]  
### Common Flags and Command Modifiers  
- **DVT help** or `dvt -h` provides an overview of all commands and flags; standard across many CLI tools.  
- **DVT version** displays the installed version of the DVT tool and whether updates are available.  
- **DVT run --full-refresh** forces a full rebuild of incremental models by dropping and reloading all data.  
  - Useful when historical data changes or duplicates appear, typically performed monthly or as needed.  
- **Fail-fast flag** makes DVT treat warnings as errors and fail immediately, promoting strict quality control during testing and builds.  
- **Target flag (`-t` or `--target`)** allows running commands against different environments:  
  - Default is usually `dev`.  
  - Can be switched to `pro` (production) or any other target defined in `profiles.jamo`.  
  - Recommended practice: develop on `dev` and deploy on `pro`.

[00:11:21]  
### Using the Select Flag to Run Specific Models  
- **Select (`-s` or `--select`)** enables running a subset of models instead of the entire project. Examples:  
  - Single model by name (e.g., `staging_green_trip_data`)  
  - Models in a specific folder or with certain tags  
- Select supports dependency expansion with plus signs:  
  - **Single plus (`+`)** runs the selected model plus **upstream** dependencies (models it depends on) or **downstream** dependencies (models depending on it), depending on the syntax position.  
  - **Double plus (`++`)** runs both **upstream and downstream** dependencies along with the selected model.  
- This is useful for incremental development and testing of parts of the project without running everything.  
- Select also supports advanced filtering such as running only **new** or **modified** models based on project state.

[00:14:59]  
### Managing State for Select in DVT Core vs. DVT Cloud  
- **State-based selection** requires having prior run artifacts (`manifest.json` and others) stored externally to detect changes.  
- In **DVT Cloud**, state management is automatic and transparent to users.  
- In **DVT Core**, users must manually back up these JSON artifacts to a safe location outside the active project folder to avoid overwriting or corrupting state files.  
- This practice enables incremental runs based on changes and also provides a useful backup and analytics source for project evolution.

---

### Summary of Important DVT Commands and Flags

| Command       | Description                                                                                     | Notes                                      |
|---------------|-------------------------------------------------------------------------------------------------|--------------------------------------------|
| `dvt init`    | Initializes project directory structure                                                        | Run once at start                           |
| `dvt debug`   | Checks database connection validity                                                            | Useful for early troubleshooting            |
| `dvt seed`    | Loads CSV files from the seeds folder                                                           |                                            |
| `dvt snapshot`| Manages snapshots (feature-specific)                                                           |                                            |
| `dvt source freshness` | Checks data freshness status                                                               |                                            |
| `dvt docs generate` | Generates documentation artifact `catalog.json`                                               | Automated on DVT Cloud                      |
| `dvt docs surf` | Browses local documentation website                                                           | Not needed on DVT Cloud                     |
| `dvt clean`   | Removes targets and packages or custom specified files                                          | Requires reinstalling dependencies afterwards |
| `dvt deps`    | Installs dependencies                                                                           |                                            |
| `dvt compile` | Compiles Jinja SQL into raw SQL files under `target/compiled`                                  | Helps catch errors early                     |
| `dvt run`     | Runs all models in the project                                                                 | Materializes models according to config    |
| `dvt test`    | Runs all defined tests                                                                          | Reports pass/fail status                     |
| `dvt build`   | Composite command: runs models, tests, seeds, snapshots, UDFs in correct order; stops on failure | Efficient, skips unnecessary compute       |
| `dvt retry`   | Resumes build/run from point of failure                                                        | Saves time on large projects                 |

| Flag/Option           | Description                                                                                          |
|-----------------------|------------------------------------------------------------------------------------------------------|
| `-h`, `--help`        | Shows help documentation                                                                              |
| `--version`           | Displays installed DVT version                                                                        |
| `--full-refresh`      | Drops and reloads incremental models fully                                                           |
| `--fail-fast`         | Treats warnings as errors and fails immediately                                                        |
| `-t`, `--target`      | Specifies environment target (e.g., dev, pro)                                                         |
| `-s`, `--select`      | Runs selected models only; supports dependency expansion via `+` or `++`                              |
| `--state`             | Uses external saved artifacts for incremental runs (requires manual artifact backup in DVT Core)      |

---

### Key Insights  
- **DVT build is the most efficient way to build and test a project**, as it combines multiple steps intelligently and saves compute by skipping dependent models after failures.  
- **DVT retry** is important for large projects to avoid complete reruns after errors.  
- **Using the select flag with dependency expansion (`+` and `++`) enables fine-grained control over what parts of the project run, improving development speed.**  
- **Managing artifacts like `manifest.json` outside the project directory is crucial for stateful incremental runs in DVT Core**, whereas DVT Cloud automates this.  
- **Flags such as full-refresh and fail-fast improve robustness and ensure data quality.**  
- Understanding these commands and flags is essential for efficient, scalable use of DVT in both development and production environments.

---

### Conclusion  
The video provides a comprehensive walkthrough of essential DVT commands and flags, emphasizing practical usage patterns, project initialization, debugging, selective model execution, and effective error handling. It highlights the importance of understanding the command suite to optimize workflows, especially in large data transformation projects. The distinction between DVT Cloud and DVT Core regarding documentation hosting and state management is also clearly stated, helping users choose suitable approaches for their environments.