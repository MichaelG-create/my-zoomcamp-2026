# dbt Course

## Seeds and Macros
[![](https://markdown-videos-api.jorgenkh.no/youtube/lT4fmTDEqVk)](https://youtu.be/lT4fmTDEqVk)


[00:00:00]  
The video begins by discussing **vendor IDs and drop-off location codes** present in the dataset. There are only three vendor IDs: 1, 2, and 4. The speaker identified these vendors as real companies:  
- **Vendor 1:** Creative Mobile Technologies  
- **Vendor 2:** Berhone Inc.  
- **Vendor 4:** Unknown or Other  

It is noted that over time, more vendors have been added to the dataset, suggesting dynamic data growth. The speaker emphasizes the need to integrate this vendor information properly to improve clarity.

Regarding **location IDs**, there are approximately 263 to 265 unique locations. However, some drop-off locations might be missing or unassigned. The speaker points out the opportunity to enhance the dataset by converting these IDs to meaningful names and adding additional metadata (such as location type or coordinates).

[00:01:21]  
To enrich location data, the speaker introduces **dbt’s “seats” feature** as a solution. The seats feature allows importing a CSV file containing location metadata (location ID, borough, zone, service type) directly into the project as a temporary lookup table without needing data warehouse ingestion or permissions. This method facilitates quick local testing and development.  

However, the speaker warns about limitations of this approach:  
- Avoid committing sensitive data in the CSV to version control repositories like Git.  
- Keep the dataset small to prevent slowing down Git operations (pull, push), as large files degrade performance.  

Despite these caveats, the seats method is presented as a **“quick and dirty” but useful approach** for local development and lookup needs.

[00:02:43]  
After importing the CSV through dbt seats, the speaker demonstrates querying the newly created model (`taxi_zone_lookup`) to confirm successful ingestion. This model can be queried like any other table within the dbt project, allowing the use of enriched location metadata in SQL queries.  

The speaker suggests renaming this model to something clearer like `dim_zones` or `dim_locations` to better reflect its role as a **dimension table** that can be expanded with additional attributes.

[00:05:09]  
Next, the speaker focuses on creating a **vendor dimension table** from the trips dataset. The process involves selecting distinct vendor IDs from unioned trip data (`trips_union`).  

To enrich this data with vendor names, the speaker initially considers using a **`CASE WHEN`** statement mapping vendor IDs to their names, but rightly critiques this approach as:  
- Tedious and error-prone to maintain as vendors change or new ones appear.  
- Not reusable across different queries or models without duplication.  

[00:06:52]  
Instead, the speaker introduces **dbt macros**, which are reusable SQL code snippets analogous to Python functions. Macros allow code reuse and parameterization, improving maintainability and readability.  

A macro called `get_vendor_names` is created that takes a `vendor_id` as input and returns the corresponding vendor name. This approach:  
- Avoids repeated `CASE WHEN` logic in multiple places.  
- Enables easier updates—modifying vendor names requires changing the macro only once.  
- Improves code clarity by abstracting the mapping logic into a dedicated function.  

[00:08:50]  
The speaker then shows how to call this macro within the vendor dimension model by passing the `vendor_id` column to the macro function. They confirm that the SQL generated by dbt effectively inlines the macro’s code, ensuring the same functionality but with a cleaner development experience.

[00:10:08]  
The final segment outlines **homework tasks** related to building the **fact trips table**:  
- Ensure **one row per trip**, regardless of taxi color (yellow or green).  
- Define a **unique primary key** (`trip_id`) for each trip. The speaker reveals the dataset contains duplicates, originating from both source data and joins, which must be investigated and resolved.  
- Enrich certain columns, such as `payment_type`, which currently uses numeric codes (1, 2, 3). The speaker hints at providing a lookup table via dbt seats to map these codes to descriptive labels.  

This homework sets the foundation for improving data quality and usability in the fact table.

[00:12:03]  
The video concludes by previewing the **next topics** in the series: documentation and testing, which are essential for maintaining data pipeline quality and reliability.

---

### Key Insights and Concepts

- **Vendor and Location IDs** need enrichment with meaningful names and metadata to improve dataset usability.
- **dbt seats feature** allows quick ingestion of small CSV lookup tables into projects without warehouse ingestion, suitable for local testing but with limitations for production.
- **Dimension tables** (`dim_zones`, `dim_vendors`) are constructed to provide enriched, descriptive attributes for IDs in the fact data.
- **Avoid `CASE WHEN` for mapping** in favor of reusable **dbt macros**, which encapsulate SQL logic akin to functions, improving maintainability and preventing duplication.
- Dataset contains **duplicates in trip data**, requiring careful deduplication strategies.
- Enrichment of coded columns (e.g., payment types) through lookup tables will enhance data interpretability.
- Upcoming focus on **documentation and testing** emphasizes good data engineering practices.

---

### Summary Table: Vendors Mapping

| Vendor ID | Vendor Name              | Notes             |
|-----------|--------------------------|-------------------|
| 1         | Creative Mobile Technologies | Official vendor    |
| 2         | Berhone Inc.             | Official vendor    |
| 4         | Unknown / Other          | Catch-all category |

---

### Summary Table: Location Metadata (via CSV lookup)

| Attribute      | Description                      |
|----------------|---------------------------------|
| Location ID    | Numeric ID for drop-off locations|
| Borough        | Borough name (geographical area)|
| Zone           | Taxi zone name                  |
| Service        | Service type or category         |

---

### Glossary of dbt Features

| Feature      | Description                                                                                     | Use Case                                    |
|--------------|-------------------------------------------------------------------------------------------------|---------------------------------------------|
| Seats        | Temporary model created by importing CSV files locally into dbt project                         | Quick local lookup of static reference data|
| Macros       | Reusable SQL code snippets with parameters, similar to functions in programming languages       | Encapsulating repeated logic (e.g., vendor name mapping) |

---

### Homework Overview

- Create a **fact trips table** with unique trip records.
- Identify and resolve **duplicates** in the trip data.
- Enrich coded columns like `payment_type` using lookup tables.
- Prepare for upcoming **documentation and testing** tasks.

---

This detailed summary strictly adheres to the video transcript content, highlighting the technical workflow and tools used for data enrichment and modeling within dbt, as well as best practices for maintainability and data quality.